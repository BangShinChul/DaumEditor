<?xml version="1.0"?>
<project name="trex_build_css">
    <property file="build.properties"/>

    <taskdef resource="net/sf/antcontrib/antcontrib.properties">
        <classpath>
            <pathelement location="${lib.dir}/ant-contrib-1.0b3.jar"/>
        </classpath>
    </taskdef>


    <!-- merge & minify css -->
    <target name="merge_editor_css">
        <echo message="Merge editor.css ..."/>
        <mkdir dir="${build.target.editor.css.dir}/merged"/>
        <java jar="${lib.rhino.path}" failonerror="true" fork="true">
            <arg value="${build.js.dir}/concatStylesheet.js"/>
            <arg value="${build.target.editor.css.dir}/merged/editor.css"/>
            <arg value="${src.editor.css.dir}"/>
            <arg value="editor.css"/>
        </java>

        <copy file="${src.editor.css.dir}/popup.css"
            tofile="${build.target.editor.css.dir}/merged/popup.css" overwrite="true"/>
    </target>

    <target name="merge_content_css">
        <mkdir dir="${build.target.editor.css.dir}/merged"/>

        <echo message="Merge content_view.css ..."/>
        <java jar="${lib.rhino.path}" failonerror="true" fork="true">
            <arg value="${build.js.dir}/concatStylesheet.js"/>
            <arg value="${build.target.editor.css.dir}/merged/content_view.css"/>
            <arg value="${src.editor.css.dir}"/>
            <arg value="content_view.css"/>
        </java>

        <java jar="${lib.rhino.path}" failonerror="true" fork="true">
            <arg value="${build.js.dir}/concatStylesheet.js"/>
            <arg value="${build.target.editor.css.dir}/merged/content_wysiwyg.css"/>
            <arg value="${src.editor.css.dir}"/>
            <arg value="content_wysiwyg.css"/>
        </java>
    </target>


    <target name="minify_stylesheets">
        <foreach list="${css.list}" param="css_fname" target="    _minify_stylesheet" />
    </target>


    <target name="    _minify_stylesheet">
        <!--suppress AntResolveInspection -->
        <echo message="Minify ${css_fname}.css"/>

        <java classname="com.yahoo.platform.yui.compressor.YUICompressor"
              classpath="${lib.yuicompressor.path}" failonerror="true">
            <arg value="--type"/>
            <arg value="css"/>
            <arg value="--charset"/>
            <arg value="utf-8"/>
            <arg value="--line-break"/>
            <arg value="1000"/>

            <arg file="${build.target.editor.css.dir}/merged/${css_fname}.css"/>
            <arg value="-o"/>
            <arg file="${build.target.editor.css.dir}/${css_fname}.css"/>
        </java>
    </target>

</project>
