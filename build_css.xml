<?xml version="1.0"?>
<project name="trex_build_css">
    <property file="build.properties"/>

    <taskdef resource="net/sf/antcontrib/antcontrib.properties">
        <classpath>
            <pathelement location="${lib.dir}/ant-contrib-1.0b3.jar"/>
        </classpath>
    </taskdef>


    <!-- merge & minify css -->
    <target name="merge_editor_css">
    	<!--suppress AntResolveInspection -->
        <echo message="Merge editor.css ..."/>
        <java jar="${lib.rhino.path}" failonerror="true" fork="true">
            <arg value="${build.js.dir}/concatStylesheet.js"/>
            <!--suppress AntResolveInspection -->
            <arg value="${editor.src.dir}/css/editor.origin.css"/>
            <arg value="${working.dir}"/>
            <!--suppress AntResolveInspection -->
            <arg value="/css/editor.css"/>
        </java>
        <copy file="${working.dir}/css/popup.css" tofile="${editor.src.dir}/css/popup.origin.css" overwrite="true"/>
    </target>

    <target name="merge_content_css">
        <echo message="Merge content_view.css ..."/>
        <java jar="${lib.rhino.path}" failonerror="true" fork="true">
            <arg value="${build.js.dir}/concatStylesheet.js"/>
            <arg value="${editor.src.dir}/css/content_view.origin.css"/>
            <arg value="${working.dir}"/>
            <arg value="/css/content_view.css"/>
        </java>

        <java jar="${lib.rhino.path}" failonerror="true" fork="true">
            <arg value="${build.js.dir}/concatStylesheet.js"/>
            <arg value="${editor.src.dir}/css/content_wysiwyg.origin.css"/>
            <arg value="${working.dir}"/>
            <arg value="/css/content_wysiwyg.css"/>
        </java>
    </target>


    <target name="minify_stylesheets">
        <foreach list="${css.list}" param="css_fname" target="    _minify_stylesheet" />
    </target>


    <target name="    _minify_stylesheet">
        <!--suppress AntResolveInspection -->
        <echo message="Minify ${css_fname}.css"/>

        <java classname="com.yahoo.platform.yui.compressor.YUICompressor"
              classpath="${lib.yuicompressor.path}" failonerror="true">
            <arg value="--type"/>
            <arg value="css"/>
            <arg value="--charset"/>
            <arg value="utf-8"/>
            <arg value="--line-break"/>
            <arg value="1000"/>
            <!--suppress AntResolveInspection -->
            <arg file="${editor.src.dir}/css/${css_fname}.origin.css"/>
            <arg value="-o"/>
            <!--suppress AntResolveInspection -->
            <arg file="${editor.src.dir}/css/${css_fname}.css"/>
        </java>
    </target>

</project>
